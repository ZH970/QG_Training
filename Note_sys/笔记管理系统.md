# 笔记管理系统

## 一、所需头源文件：

1. 主程序main；

2. 用户登录注册user:

```c
#ifndef USER_H
#define USER_H

typedef struct User {
    char username[50];
    char password[50];
} User;

// 用户注册
int registerUser(User* user);

// 用户登陆
int loginUser(User* user);

// 用户退出
void logoutUser();

#endif

// user.c
#include "user.h"

int registerUser(User* user) {
    // 注册新用户
}

int loginUser(User* user) {
    // 用户登陆
}

void logoutUser() {
    // 用户退出
}
```

3. 笔记相关操作note：

```c
// note.h
#ifndef NOTE_H
#define NOTE_H

typedef enum Status 
{
    ERROR = 0,
	SUCCESS = 1
} Status;

typedef struct note {
    char creater[100];//创建者名字
    char title[100];//笔记主题
    char path[1000];//笔记实际路径
    Tag* tag; //文件夹标签列表
    struct note *next;
} Note;

// 显示当前目录下所有的笔记文件
void showNotesInFolder(Folder* folder);

// 按照树状结构显示所有的笔记文件
void showNotesInTree(Folder* folder, int depth);

// 显示命令指定文件下所有的笔记文件
void showNotesInDirectory(char* directory);

// 显示命令指定文件下所有的带有搜索内容的笔记文件
void showSearchedNotesInDirectory(char* directory, char* searchContent);

// 将笔记文件移动到指定的文件夹目录下
Status moveNoteToFolder(Note* note, Folder* folder);

// 将笔记文件进行重命名，从原文件名改为目标文件名
Status renameNote(Note* note, char* newName);

// 将指定的笔记文件夹移动到目标文件夹目录下
Status moveNoteFolderToFolder(Folder* noteFolder, Folder* targetFolder);

// 对笔记文件进行删除
Status deleteNote(Note* note);

// 创建笔记文件
Status createNote(char* notePath);

// 对指定文件夹内的笔记文件按文件名首字母进行排序
Status sortNotesInFolder(Folder* folder);

#endif
```

4. 文件夹相关操作folder：

```c
// folder.h
#ifndef FOLDER_H
#define FOLDER_H

typedef enum Status 
{
    ERROR = 0,
	SUCCESS = 1
} Status;

//定义文件夹结构体
typedef struct folder {
char name[100]; //文件夹名
struct folder* parent; //父文件夹
struct folder* child; //第一个子文件夹
struct folder* sibling; //下一个兄弟文件夹
Note* note; //文件夹中笔记列表
Tag* tag; //文件夹标签列表
} Folder;

//显示当前目录下所有的笔记本文件夹
void showFolders(Folder* root);

//按照树状结构显示所有的笔记文件夹
void showFolderTree(Folder* root, int depth);

//显示命令指定文件下所有的文件夹
void showFoldersInDirectory(char* path);

//显示命令指定文件下所有的带有搜索内容的文件夹名
void showFoldersWithSearchTerm(char* path, char* searchTerm);

//将路径切换为当前目录的父目录. 若是根目录则则不进行切换
Folder* moveUpDirectory(Folder* currentFolder);

//将路径切换为命令中输入的文件夹路径
Folder* moveDirectory(Folder* root, char* path);

//将指定的笔记文件夹移动到目标文件夹目录下
Status moveFolderToDirectory(Folder* sourceFolder, Folder* targetFolder);

//删除指定文件夹以及其内部所有内容
Statu deleteFolderRecursive(Folder* folder);

// 创建文件夹
Folder* createFolder(char* name);

// 删除文件夹
Status deleteFolder(Folder* folder);

// 查找文件夹
Folder* findFolder(Folder* root, char* path);

// 添加文件夹
Status addFolder(Folder* root, char* path);

// 移动文件夹
Status moveFolder(Folder* root, char* oldPath, char* newPath);

// 重命名文件夹
Status renameFolder(Folder* folder, char* name);

// 从文件夹中删除笔记
Status deleteNoteFromFolder(Folder* folder, char* noteName);

// 添加笔记到文件夹
Status addNoteToFolder(Folder* folder, Note* note);

//保存数据
void saveFolderToFile(Folder* folder, FILE* fp);

//读取数据
Folder* readFolderFromFile(FILE* fp);

#endif
```

5. 标签相关操作tag：

```c
// tag.h
#ifndef TAG_H
#define TAG_H

typedef enum Status 
{
    ERROR = 0,
	SUCCESS = 1
} Status;

typedef struct Tag {
    char name[50];//标签名
    struct Tag* next;
} Tag;

// 添加笔记标签(注意标签有重名检测，成功返回SUCCESS，失败返回ERROR)
Status addTagToNote(Note* note, char* tagName);

// 添加文件夹标签(注意标签有重名检测，成功返回SUCCESS，失败返回ERROR)
Status addTagToFolder(Folder* folder, char* tagName);

// 删除笔记标签(成功返回SUCCESS，失败返回ERROR,以下同理)
Status deleteTagFromNote(Note* note, char* tagName);

// 删除文件夹标签
Status deleteTagFromFolder(Folder* folder, char* tagName);

// 显示指定笔记的标签
Status viewTagsInNote(Note* note);

// 显示指定文件夹的标签
Status viewTagsInFolder(Folder* folder);

// 根据标签内容，在当前目录下进行笔记搜索，输出匹配的标签对应的笔记文件名
Status searchNotesInFolderByTag(Folder* folder, char* tagName);

// 根据标签内容，对所有笔记进行搜索，输出匹配的标签所对应的笔记的文件名以及绝对路径
Status searchNotesByTag(char* tagName);

#endif
```

6. 界面相关UI：

```c
//ui.h
#ifndef UI_H
#define UI_H

typedef enum Status 
{
    ERROR = 0,
	SUCCESS = 1
} Status;

#include "user.h"
#include "note.h"
#include "folder.h"
#include "tag.h"

//识别用户输入的指令并执行相应的功能
Status input(char* command);

#endif

//ui.c
#include "ui.h"
void loginScreen() {
//登录注册界面
}

void mainScreen() {
//主界面
}
```

## 二、具体细节：

- 分工的话因为不同源文件对应的工作量不同，所以user和ui板块可以交给一个人来做，其他四个人对应选择自己擅长的板块，剩下一个人来负责代码整体的组装与维修(这个工作量也不小hh)；
- 代码的话记得有关于输入输出的都要有对应容错空间，对错误的输入或不成功的输出都要有对应的检测。此外，关于在界面上的打印(比如”文件添加失败")尽量交给ui板块的同学来写，不用写在其他板块的函数里，实在没办法可以在群里跟大家说一下；
- 上述源文件里的函数和结构体不是绝对的（我能力有限哈哈），有哪些需要更改的地方可以跟群里的大家说明以下，方便各自协同工作；
- 整体项目编写的话可以将项目用一个仓库存着，要编写时可以将项目pull到本地，编写后可以再push上去（我还没试过多人一起编写所以还不太清除）；

## 三、参考函数：

- ```c
  //保存数据
  void saveFolderToFile(Folder* folder, FILE* fp) {
      if (folder == NULL) {
          return;
      }
      // 保存文件夹名
      fprintf(fp, "%s\n", folder->name);
      // 保存标签
      Tag* tag = folder->tag;
      while (tag != NULL) {
          fprintf(fp, "%s ", tag->name);
          tag = tag->next;
      }
      fprintf(fp, "\n");
      // 保存笔记
      Note* note = folder->note;
      while (note != NULL) {
          fprintf(fp, "%s %s %s ", note->creater, note->title, note->path);
          // 保存笔记的标签
          tag = note->tag;
          while (tag != NULL) {
              fprintf(fp, "%s ", tag->name);
              tag = tag->next;
          }
          fprintf(fp, "\n");
          note = note->next;
      }
      // 保存子文件夹
      Folder* child = folder->child;
      while (child != NULL) {
          saveFolderToFile(child, fp);
          child = child->sibling;
      }
  }
  
  //读取数据
  Folder* readFolderFromFile(FILE* fp) {
      char buffer[1000];
      // 读取文件夹名
      if (fgets(buffer, sizeof(buffer), fp) == NULL) {
          return NULL;
      }
      buffer[strlen(buffer) - 1] = '\0'; // 去除换行符
      Folder* folder = createFolder(buffer);
      // 读取标签
      if (fgets(buffer, sizeof(buffer), fp) == NULL) {
          return folder;
      }
      char* tag_str = strtok(buffer, " ");
      while (tag_str != NULL) {
          addTag(folder, tag_str);
          tag_str = strtok(NULL, " ");
      }
      // 读取笔记
      while (fgets(buffer, sizeof(buffer), fp) != NULL) {
          char* creater = strtok(buffer, " ");
          char* title = strtok(NULL, " ");
          char* path = strtok(NULL, " ");
          Note* note = createNote(creater, title, path);
          // 读取笔记的标签
          char* tag_str = strtok(NULL, " ");
          while (tag_str != NULL) {
              addTag(note, tag_str);
              tag_str = strtok(NULL, " ");
          }
          addNoteToFolder(folder, note);
      }
      // 读取子文件夹
      Folder* child = readFolderFromFile(fp);
      while (child != NULL) {
          addChildFolder(folder, child);
          child = readFolderFromFile(fp);
      }
      return folder;
  }
